# 问题修复说明

## 当前问题

1. **video 窗口没有显示**：创建了但没有出现在屏幕上
2. **MPV 仍然是独立窗口**：没有嵌入到 video 窗口

## 修复内容

### 1. 确保 video 窗口显示

修改了：
- `createVideoWindow()` - 添加了窗口显示逻辑
- `windowManager.createWindow()` - video 窗口在 `ready-to-show` 时显示
- `ipcHandlers.ts` - 确保窗口显示并聚焦

### 2. 改进窗口准备逻辑

- 增加等待时间：从 300ms 增加到 800ms
- 添加窗口状态检查
- 添加更多日志输出

### 3. 关键改进点

#### createVideoWindow()
```typescript
// 窗口准备好后显示
window.once('ready-to-show', () => {
  window.show()
  window.focus()
})
```

#### mpvManager.ts
- 等待 800ms 确保窗口完全准备好
- 检查窗口是否被销毁或不可见
- 输出窗口边界和状态信息

## 测试步骤

1. **重新运行应用**：
   ```bash
   npm run dev
   ```

2. **选择视频文件**：点击"选择视频文件"

3. **观察日志**：
   - `[Main] Video window ready and shown`
   - `[IPC] Video window created and shown`
   - `[MPVManager] Video window is ready`
   - `[MPVManager] Window bounds: {...}`
   - `[MPVManager] Successfully got NSView pointer: ...`

4. **观察窗口**：
   - video 窗口应该显示
   - MPV 视频应该嵌入到 video 窗口中

## 如果仍然有问题

### video 窗口仍然不显示

检查：
- 窗口是否被其他窗口遮挡
- 窗口位置是否在屏幕外
- 查看日志中的窗口状态

### MPV 仍然是独立窗口

可能原因：
1. 获取 contentView 超时（需要更多时间或简化方法）
2. MPV 不接受 NSWindow 指针（需要真正的 NSView）
3. MPV 版本不支持嵌入

下一步：
- 查看日志中的窗口指针
- 检查 MPV 版本：`mpv --version`
- 考虑使用透明窗口同步方案

## 预期结果

- ✅ video 窗口显示在屏幕上
- ✅ video 窗口包含控制面板
- ✅ MPV 视频嵌入到 video 窗口的视频区域
- ✅ 只有一个窗口，而不是两个分离的窗口
