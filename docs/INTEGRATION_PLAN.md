# 视频画面与控制面板整合方案

## 当前架构分析

### 现状
1. **MPV 进程**：在独立的原生窗口播放视频
2. **Electron 窗口**：只显示控制面板（播放/暂停、进度条、音量等）
3. **问题**：两个窗口分离，用户体验不统一

### 代码结构
- `main.ts`: 创建主窗口和视频窗口
- `mpvController.ts`: 管理 MPV 进程
- `mpvManager.ts`: 尝试获取窗口 ID 但未实际使用
- `VideoView.vue`: 显示控制面板和提示信息

---

## 整合方案对比

### 方案 1：将 MPV 嵌入到 Electron 窗口 ⭐⭐⭐⭐⭐（推荐）

**原理**：使用 MPV 的 `--wid` 参数，将 MPV 的渲染视图嵌入到 Electron 窗口的指定区域。

**优点**：
- ✅ 真正的整合，视频和控制面板在同一窗口
- ✅ 用户体验最好，窗口可统一管理
- ✅ 支持窗口缩放、最小化等标准操作

**缺点**：
- ⚠️ 在 macOS 上实现较复杂，需要获取 NSView 指针
- ⚠️ 可能需要 native 模块或使用 ffi-napi

**实现步骤**：
1. 创建一个包含视频区域和控制面板区域的布局
2. 获取 Electron 窗口的 NSView 指针（contentView）
3. 在 MPV 启动时使用 `--wid` 参数传入 view ID
4. 调整 VideoView 布局，将视频区域空出给 MPV 渲染

**技术要点**：
- macOS 上需要：`[window.contentView viewWithTag:VIDEO_VIEW_TAG]` 获取 NSView
- 可以通过 `@electron/remote` 或 native 模块（如 `ffi-napi`）访问
- 或者使用 `webContents.getNativeViewHandle()`（如果 Electron 版本支持）

---

### 方案 2：透明窗口 + 窗口同步 ⭐⭐⭐⭐（折中）

**原理**：
- Electron 窗口设为透明，只显示控制面板 overlay
- MPV 窗口在 Electron 窗口下方
- 通过窗口定位 API 让两个窗口位置和大小同步

**优点**：
- ✅ 实现相对简单，不需要 native 模块
- ✅ 视觉上可以做到看起来像一体
- ✅ 可以利用现有的控制面板 overlay

**缺点**：
- ⚠️ 两个窗口仍然分离，无法统一管理
- ⚠️ 需要实时同步窗口位置和大小
- ⚠️ 可能出现窗口不同步的问题

**实现步骤**：
1. 将 Electron 视频窗口设为透明（`transparent: true`）
2. 获取 MPV 窗口（通过窗口标题或进程 PID）
3. 监听 Electron 窗口的 `move` 和 `resize` 事件
4. 实时同步 MPV 窗口的位置和大小
5. 控制面板 overlay 始终显示在顶部

**技术要点**：
- 使用 `app.getWindowByTitle()` 或通过进程 PID 查找 MPV 窗口
- 使用 macOS 的 Accessibility API 或 AppleScript 控制窗口位置
- 或者通过 MPV 的 `--geometry` 参数控制窗口位置

---

### 方案 3：控制面板 overlay 在 MPV 窗口上 ⭐⭐⭐（简单但受限）

**原理**：
- 将控制面板做成独立的透明窗口
- 定位在 MPV 窗口上方
- 通过窗口标题或位置同步

**优点**：
- ✅ 实现最简单
- ✅ 不需要修改 MPV 嵌入逻辑

**缺点**：
- ⚠️ 三个窗口（MPV + 控制面板 + 主窗口）
- ⚠️ 窗口同步复杂
- ⚠️ 用户体验不佳

---

## 推荐方案：方案 1（MPV 嵌入）

### 详细实现步骤

#### 1. 修改窗口创建，添加视频渲染区域
- 在 VideoView 中创建一个用于嵌入 MPV 的 `<div>` 区域
- 这个区域占据窗口的主要部分，控制面板 overlay 在底部

#### 2. 获取 Electron 窗口的 NSView
- 使用 native 模块（推荐使用 `@electron/remote` 或 `ffi-napi`）
- 获取窗口的 contentView
- 创建一个用于嵌入的子视图

#### 3. 修改 MPV 启动参数
- 添加 `--wid=<view_id>` 参数
- 移除 `--no-border`（因为已经嵌入，不需要独立窗口）
- 设置 `--vo=gpu` 或 `--vo=opengl`（macOS 推荐）

#### 4. 调整 VideoView 布局
- 视频区域：占据窗口主体（flex: 1）
- 控制面板：固定在底部 overlay

### 预期效果
```
┌─────────────────────────────┐
│     Electron 窗口           │
│  ┌───────────────────────┐  │
│  │                       │  │
│  │    MPV 视频渲染区     │  │
│  │   (嵌入的 native 视图)│  │
│  │                       │  │
│  │                       │  │
│  └───────────────────────┘  │
│  ┌───────────────────────┐  │
│  │  控制面板 Overlay     │  │
│  │ [播放] [进度] [音量]  │  │
│  └───────────────────────┘  │
└─────────────────────────────┘
```

---

## 备选方案：方案 2（透明窗口同步）

如果方案 1 实现困难，可以先采用方案 2 作为过渡。

### 实现要点
1. Electron 窗口设置为透明：`transparent: true`
2. 控制面板 overlay 使用不透明背景
3. 查找 MPV 窗口（通过窗口标题或进程）
4. 使用 AppleScript 或 Accessibility API 同步窗口位置

---

## 建议

1. **优先尝试方案 1**：虽然需要一些 native 代码，但体验最好
2. **如果方案 1 困难**：可以先实现方案 2，后续再优化到方案 1
3. **评估工作量**：
   - 方案 1：需要 2-3 天（包括 native 模块集成和测试）
   - 方案 2：需要 1 天（主要是窗口同步逻辑）

你希望我帮你实现哪个方案？
