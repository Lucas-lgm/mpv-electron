# 简化后的实现：直接传递窗口句柄

## 当前实现

### 已完成的简化

1. **去掉编译逻辑**
   - 不再编译 Objective-C 代码
   - 直接使用 Electron 返回的窗口句柄

2. **简化的窗口句柄获取**
   ```typescript
   // nativeHelper.ts
   export function getNSViewPointer(window: BrowserWindow): number | null {
     const nativeHandle = window.getNativeWindowHandle()
     const windowPtr = nativeHandle.readBigUInt64LE(0)
     return Number(windowPtr)  // 直接返回窗口句柄
   }
   ```

3. **直接传递给 MPV**
   - 获取窗口句柄后，直接通过 `--wid` 参数传递给 MPV
   - MPV 应该使用这个句柄在指定窗口中渲染

## 代码流程

```
用户点击播放
    ↓
创建 video 窗口
    ↓
获取窗口句柄 (getNativeWindowHandle)
    ↓
启动 MPV，传入 --wid=<窗口句柄>
    ↓
MPV 应该在指定窗口中渲染视频
```

## 当前状态

从日志看：
- ✅ Video 窗口已创建并显示
- ✅ 窗口句柄已获取：1219796902464
- ✅ 窗口句柄已传递给 MPV：`--wid=1219796902464`
- ❌ 但 MPV 仍然创建了独立窗口

## 可能的原因

1. **句柄类型问题**：
   - Electron 返回的是 NSWindow 指针
   - MPV 可能需要 NSView（contentView）指针
   - 但用户说不需要编译，所以直接使用窗口句柄

2. **MPV 版本或配置问题**：
   - MPV 可能不支持这种嵌入方式
   - 或者需要其他参数

## 下一步

1. **检查 MPV 的错误输出**
   - 查看是否有关于窗口嵌入的错误信息
   - 检查 MPV 是否接受了这个句柄

2. **测试不同的 MPV 参数**
   - 可能需要额外的参数来让 MPV 接受窗口句柄

3. **验证窗口句柄是否正确**
   - 确认句柄值是否正确
   - 确认窗口是否完全准备好

## 调试建议

运行应用时，关注日志中的：
- `[NativeHelper] ✅ Got window handle: ...`
- `[MPVController] Embedding into window with ID: ...`
- `[MPV] stderr:` - 查看是否有窗口相关的错误

如果 MPV 仍然创建独立窗口，可能需要：
1. 检查 MPV 版本：`mpv --version`
2. 查看 MPV 文档关于 `--wid` 参数的说明
3. 或者使用其他方式让 MPV 在指定窗口中渲染
