# 代码规范

> **版本**: 1.5.0  
> **最后更新**: 2026-01-26

## 💻 代码规范

### 文件组织原则
- **一个文件一个类/接口**：每个文件最多包含一个主要的类或接口定义，保持文件职责单一
- **统一入口文件**：基础设施层模块应提供 `index.ts` 作为统一导出入口
 - 外部代码从模块目录导入（如 `from 'infrastructure/mpv'`）
 - 内部文件间使用相对路径（如 `from './types'`）
 - 统一导出所有类型、类、函数，隐藏内部文件结构
- **类型归类**：相关类型定义应归类到 `types.ts` 文件中，而不是分散在多个文件
- **延迟加载**：native binding 等资源加载应封装为方法，不在文件加载时自动执行

### TypeScript
- 严格模式，类型安全
- 使用接口定义契约
- 避免 any，使用 unknown 或具体类型

### Vue 3
- Composition API
- TypeScript 支持
- 组件职责单一
- 使用 composables 复用逻辑

### IPC 通信模式
```typescript
// renderer → preload → main
// 1. renderer 调用 window.electronAPI.xxx()
// 2. preload 通过 contextBridge 暴露 API
// 3. main 通过 ipcMain.on() 处理
```

### 错误处理
- Promise 使用 try-catch
- IPC 通信要有错误回调
- 原生模块调用要处理异常

## 🚫 禁止行为

- ❌ 未经规划直接修改代码
- ❌ 忽略 Electron 进程边界
- ❌ 破坏现有的 HDR 渲染逻辑
- ❌ 不提供测试方案
- ❌ 跳过错误处理
- ❌ 破坏类型安全
- ❌ **创建重复文档**（必须先搜索现有文档，更新而不是创建）
- ❌ **创建重复代码模块**（必须先搜索现有代码，复用或扩展而不是创建）
- ❌ **保留无用代码/文档/脚本**（定期清理，保持代码库整洁）
- ❌ **架构/代码变更后不更新架构文档，或等用户提醒后再更新**

## ✅ 推荐行为

- ✅ 先分析再规划
- ✅ 分步骤详细说明
- ✅ 考虑架构影响
- ✅ 提供测试建议
- ✅ 保持代码风格一致
- ✅ 遵循现有模式
- ✅ **创建文档前先搜索现有文档**
- ✅ **更新现有文档而不是创建新文档**
- ✅ **创建代码前先搜索现有代码**
- ✅ **复用或扩展现有代码而不是创建新代码**
- ✅ **定期清理无用代码、文档、脚本**
- ✅ **重构后删除旧实现**
